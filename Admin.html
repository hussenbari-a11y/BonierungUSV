<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Bonierung ‚Äì Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase SDKs (CDN, kompatibel mit normalem HTML) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 6px; margin: 4px; }
    .ok { color: green; }
    .err { color: red; }
  </style>
</head>
<body>

<h2>Bonierung ‚Äì Admin</h2>

<label>Event-ID:</label>
<input id="eventId" value="live-saufwertung-usv" />
<button onclick="loadEvent()">Event laden</button>
<span id="status">offline</span>

<hr>

<label>Email:</label>
<input id="email" type="email" />
<label>Passwort:</label>
<input id="password" type="password" />
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>
<span id="user"></span>

<hr>

<button onclick="testWrite()">üî• Test-Write (1 Getr√§nk)</button>

<pre id="log"></pre>

<script>
/* ============================
   Firebase Konfiguration
   ============================ */
const firebaseConfig = {
  apiKey: "AIzaSyCfVcbK7TfylUqkG1q0kxsClot91n0I4fE",
  authDomain: "bonierung-usv.firebaseapp.com",
  projectId: "bonierung-usv",
  storageBucket: "bonierung-usv.firebasestorage.app",
  messagingSenderId: "284808411878",
  appId: "1:284808411878:web:7555ecae33f7ab79615927",
  measurementId: "G-107XQLKP9M"
};

/* ============================
   Firebase Initialisierung
   ============================ */
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

let currentEvent = null;

/* ============================
   Auth
   ============================ */
auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("user").textContent = user.email;
    log("Eingeloggt");
  } else {
    document.getElementById("user").textContent = "";
    log("Ausgeloggt");
  }
});

function login() {
  auth.signInWithEmailAndPassword(
    email.value,
    password.value
  ).catch(e => log(e.message, true));
}

function logout() {
  auth.signOut();
}

/* ============================
   Event
   ============================ */
function loadEvent() {
  currentEvent = eventId.value.trim();
  document.getElementById("status").textContent = "online";
  document.getElementById("status").className = "ok";
  log("Event geladen: " + currentEvent);
}

/* ============================
   TEST-WRITE
   ============================ */
async function testWrite() {
  if (!currentEvent) return log("Kein Event geladen", true);

  try {
    await db.collection("events")
      .doc(currentEvent)
      .set({
        live: {
          aggregates: {
            teamA: {
              personen: 10,
              alkohol: 1,
              euro: 5
            }
          }
        },
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

    log("‚úÖ Write erfolgreich");
  } catch (e) {
    log(e.message, true);
  }
}

/* ============================
   Log
   ============================ */
function log(msg, err=false) {
  const el = document.getElementById("log");
  el.textContent += (err ? "‚ùå " : "‚úÖ ") + msg + "\n";
}
</script>

</body>
</html>
